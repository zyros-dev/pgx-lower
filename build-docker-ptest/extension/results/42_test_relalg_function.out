LOAD 'pgx_lower.so';
-- Create a simple test table
DROP TABLE IF EXISTS test_relalg;
NOTICE:  table "test_relalg" does not exist, skipping
CREATE TABLE test_relalg (id INTEGER, value INTEGER);
INSERT INTO test_relalg VALUES (1, 100), (2, 200), (3, 300);
-- Test direct RelAlg execution: simple table scan
SELECT * FROM pgx_lower_test_relalg(
  format($$
module {
  func.func @main() -> !dsa.table {
    %%0 = relalg.basetable {
      column_order = ["id", "value"],
      table_identifier = "test_relalg|oid:%s"
    } columns: {
      id => @test_relalg::@id({type = i32}),
      value => @test_relalg::@value({type = i32})
    }
    %%1 = relalg.materialize %%0 [@test_relalg::@id, @test_relalg::@value] => ["id", "value"] : !dsa.table
    return %%1 : !dsa.table
  }
}
$$, (SELECT oid FROM pg_class WHERE relname = 'test_relalg'))
) AS t(id INTEGER, value INTEGER);
WARNING:  [PROBLEM:WARNING_LEVEL] mlir_runner_utils.cpp:146: Failed to open file for writing: /tmp/pgx_ir/pgx_lower_Phase 3a before optimization_20251103_204712.mlir
WARNING:  [PROBLEM:WARNING_LEVEL] mlir_runner_utils.cpp:146: Failed to open file for writing: /tmp/pgx_ir/pgx_lower_Phase 3a AFTER: RelAlg -> Optimised RelAlg_20251103_204712.mlir
WARNING:  [PROBLEM:WARNING_LEVEL] mlir_runner_utils.cpp:146: Failed to open file for writing: /tmp/pgx_ir/pgx_lower_Phase 3a AFTER: RelAlg -> DB+DSA+Util_20251103_204712.mlir
WARNING:  [PROBLEM:WARNING_LEVEL] mlir_runner_utils.cpp:146: Failed to open file for writing: /tmp/pgx_ir/pgx_lower_Phase 3b BEFORE: DB+DSA -> Standard_20251103_204712.mlir
WARNING:  [PROBLEM:WARNING_LEVEL] mlir_runner_utils.cpp:146: Failed to open file for writing: /tmp/pgx_ir/pgx_lower_After dsa standard pipeline pm1_20251103_204712.mlir
WARNING:  [PROBLEM:WARNING_LEVEL] mlir_runner_utils.cpp:146: Failed to open file for writing: /tmp/pgx_ir/pgx_lower_After dsa standard pipeline pm2_20251103_204712.mlir
WARNING:  [PROBLEM:WARNING_LEVEL] mlir_runner_utils.cpp:146: Failed to open file for writing: /tmp/pgx_ir/pgx_lower_After func pipeline_20251103_204712.mlir
WARNING:  [PROBLEM:WARNING_LEVEL] mlir_runner_utils.cpp:146: Failed to open file for writing: /tmp/pgx_ir/pgx_lower_Phase 3c BEFORE: Standard -> LLVM_20251103_204712.mlir
WARNING:  [PROBLEM:WARNING_LEVEL] mlir_runner_utils.cpp:146: Failed to open file for writing: /tmp/pgx_ir/pgx_lower_Phase 3c AFTER: Standard -> LLVM_20251103_204712.mlir
 id | value 
----+-------
  1 |   100
  2 |   200
  3 |   300
(3 rows)

DROP TABLE test_relalg;
