containers:
  dev:
    name: "pgx-lower-dev"
    port: 54320

  benchmark:
    name: "pgx-lower-benchmark"
    port: 54322

  host-profile:
    name: "host-native-profile"
    port: 54325

profiles:
  quick:
    runs:
      - container: benchmark
        scale_factor: 0.01
        iterations: 1
        profile: false
        heap: false
        indexes: false
        skipped_queries: ""

      - container: host-profile
        scale_factor: 0.01
        iterations: 1
        profile: true
        heap: true
        indexes: false
        skipped_queries: ""

      - container: dev
        scale_factor: 0.01
        iterations: 1
        profile: false
        heap: false
        indexes: false
        skipped_queries: ""

  profile:
    runs:
      - container: host-profile
        scale_factor: 0.01
        iterations: 1
        profile: true
        heap: true
        indexes: false
        skipped_queries: ""

      - container: host-profile
        scale_factor: 0.03
        iterations: 1
        profile: true
        heap: true
        indexes: false
        skipped_queries: ""

      - container: host-profile
        scale_factor: 0.05
        iterations: 1
        profile: true
        heap: true
        indexes: false
        skipped_queries: ""


  full:
    runs:
      - container: benchmark
        scale_factor: 0.01
        iterations: 1
        profile: false
        heap: false
        indexes: false
        skipped_queries: ""
        label: "SF=0.01, indexes disabled, 5 iterations"

      - container: benchmark
        scale_factor: 0.01
        iterations: 1
        profile: false
        heap: false
        indexes: false
        skipped_queries: "q07,q20"
        label: "SF=0.01, indexes disabled - excluding postgres {q07,q20}, 100 iterations"

      - container: benchmark
        scale_factor: 0.01
        iterations: 1
        profile: false
        heap: false
        indexes: true
        skipped_queries: ""
        label: "SF=0.01, indexes enabled, 100 iterations"

      - container: benchmark
        scale_factor: 0.16
        iterations: 1
        profile: false
        heap: false
        indexes: true
        skipped_queries: ""
        label: "SF=0.16, indexes enabled, 5 iterations"

      - container: benchmark
        scale_factor: 0.16
        iterations: 1
        profile: false
        heap: false
        indexes: true
        skipped_queries: "q17,q20"
        label: "SF=0.16, indexes enabled, excluding {q17,q20}, 100 iterations"

      - container: benchmark
        scale_factor: 1
        iterations: 1
        profile: false
        heap: false
        indexes: false
        skipped_queries: "q02,q17,q20,q21"
        label: "SF=1, indexes disabled, excluding {q02,q17,q20,q21}, 100 iterations"


environment:
  PYTHONUNBUFFERED: "1"

validation:
  check_containers: true
  check_postgres: true
  check_python_deps: true
