-- Test WHERE clause with logical combinations: AND, OR, NOT
LOAD 'pgx_lower';
NOTICE:  Installing custom executor hook...
NOTICE:  Registering custom sigsegv handler!
DROP TABLE IF EXISTS test_where_logical;
NOTICE:  table "test_where_logical" does not exist, skipping
CREATE TABLE test_where_logical (
    id SERIAL PRIMARY KEY,
    age INTEGER,
    score INTEGER,
    active BOOLEAN,
    department VARCHAR(20)
);

INSERT INTO test_where_logical(age, score, active, department) VALUES 
    (25, 85, true, 'Engineering'),
    (30, 92, false, 'Marketing'),
    (22, 78, true, 'Engineering'),
    (35, 88, true, 'Sales'),
    (28, 95, false, 'Marketing'),
    (32, 72, true, 'Sales'),
    (26, 89, false, 'Engineering');

-- Test WHERE with AND conditions
-- These should trigger MLIR compilation with logical AND operations
SELECT id, age, score FROM test_where_logical WHERE age > 25 AND score > 85;
 id | age | score 
----+-----+-------
  2 |  30 |    92
  4 |  35 |    88
  5 |  28 |    95
  7 |  26 |    89
(4 rows)

SELECT department, age FROM test_where_logical WHERE active = true AND age < 30;
 department  | age 
-------------+-----
 Engineering |  25
 Engineering |  22
(2 rows)

SELECT id, department FROM test_where_logical WHERE score >= 85 AND department = 'Engineering';
 id | department  
----+-------------
  1 | Engineering
  7 | Engineering
(2 rows)

-- Test WHERE with OR conditions
SELECT id, age, score FROM test_where_logical WHERE age < 25 OR score > 90;
 id | age | score 
----+-----+-------
  2 |  30 |    92
  3 |  22 |    78
  5 |  28 |    95
(3 rows)

SELECT department, active FROM test_where_logical WHERE department = 'Sales' OR department = 'Marketing';
 department | active 
------------+--------
 Marketing  | f
 Sales      | t
 Marketing  | f
 Sales      | t
(4 rows)

SELECT id, age FROM test_where_logical WHERE age > 35 OR active = false;
 id | age 
----+-----
  2 |  30
  5 |  28
  7 |  26
(3 rows)

-- Test WHERE with NOT conditions
SELECT id, age, department FROM test_where_logical WHERE NOT active;
 id | age | department  
----+-----+-------------
  2 |  30 | Marketing
  5 |  28 | Marketing
  7 |  26 | Engineering
(3 rows)

SELECT age, score FROM test_where_logical WHERE NOT (age < 25);
 age | score 
-----+-------
  25 |    85
  30 |    92
  35 |    88
  28 |    95
  32 |    72
  26 |    89
(6 rows)

SELECT department FROM test_where_logical WHERE NOT (department = 'Engineering');
 department 
------------
 Marketing
 Sales
 Marketing
 Sales
(4 rows)

-- Test WHERE with complex logical combinations
SELECT id, age, score FROM test_where_logical WHERE (age > 25 AND score > 80) OR (active = false);
 id | age | score 
----+-----+-------
  1 |  25 |    85
  2 |  30 |    92
  4 |  35 |    88
  5 |  28 |    95
  7 |  26 |    89
(5 rows)

SELECT department, age FROM test_where_logical WHERE active = true AND (age < 30 OR score > 85);
 department  | age 
-------------+-----
 Engineering |  25
 Engineering |  22
 Sales       |  35
(3 rows)

SELECT id, department FROM test_where_logical WHERE NOT (age < 25 OR score < 80);
 id | department  
----+-------------
  1 | Engineering
  2 | Marketing
  4 | Sales
  5 | Marketing
  7 | Engineering
(5 rows)

-- Test WHERE with multiple AND/OR combinations
SELECT age, score, department FROM test_where_logical WHERE age > 25 AND score > 80 AND active = true;
 age | score | department 
-----+-------+------------
  35 |    88 | Sales
(1 row)

SELECT id, age FROM test_where_logical WHERE age < 30 OR score > 90 OR department = 'Sales';
 id | age 
----+-----
  1 |  25
  2 |  30
  3 |  22
  4 |  35
  5 |  28
  6 |  32
(6 rows)

DROP TABLE test_where_logical;