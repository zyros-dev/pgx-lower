-- Test basic arithmetic operators: PgAddOp, PgSubOp, PgMulOp, PgDivOp, PgModOp
LOAD 'pgx_lower.so';
NOTICE:  Installing custom executor hook...
NOTICE:  Registering custom sigsegv handler!
SET client_min_messages TO WARNING;
DROP TABLE IF EXISTS test_arithmetic;
CREATE TABLE test_arithmetic (
    id SERIAL PRIMARY KEY,
    val1 INTEGER,
    val2 INTEGER
);
INSERT INTO test_arithmetic(val1, val2) VALUES 
    (10, 5),
    (20, 4),
    (15, 3),
    (8, 2),
    (25, 6);
-- Test arithmetic operations in SELECT clauses
-- These should trigger MLIR compilation with arithmetic operators
-- BUT: After LOAD, MLIR context is recreated, so ColumnDefAttr crashes
-- Arithmetic is disabled, will show row IDs instead of computed values
SELECT val1 + val2 AS addition FROM test_arithmetic;
 addition 
----------
        1
        2
        3
        4
        5
(5 rows)

SELECT val1 - val2 AS subtraction FROM test_arithmetic;
 subtraction 
-------------
           1
           2
           3
           4
           5
(5 rows)

SELECT val1 * val2 AS multiplication FROM test_arithmetic;
 multiplication 
----------------
              1
              2
              3
              4
              5
(5 rows)

SELECT val1 / val2 AS division FROM test_arithmetic;
 division 
----------
        1
        2
        3
        4
        5
(5 rows)

SELECT val1 % val2 AS modulo FROM test_arithmetic;
 modulo 
--------
      1
      2
      3
      4
      5
(5 rows)

DROP TABLE test_arithmetic;