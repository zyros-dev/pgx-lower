LOAD
'pgx_lower.so';
DROP TABLE IF EXISTS test_aggregates;
NOTICE:  table "test_aggregates" does not exist, skipping
CREATE TABLE test_aggregates
(
    id       SERIAL PRIMARY KEY,
    category INTEGER,
    amount   INTEGER,
    quantity INTEGER,
    price    INTEGER
);
INSERT INTO test_aggregates(category, amount, quantity, price)
VALUES (1, 10050, 5, 2010),
       (2, 20075, 3, 6692),
       (1, 15025, 7, 2146),
       (3, 30000, 2, 15000),
       (2, 17580, 4, 4395),
       (1, 12560, 6, 2093),
       (3, 25040, 1, 25040);
SELECT SUM(amount) AS total_amount_all
FROM test_aggregates;
NOTICE:  [PGX-LOWER] Routing through PGX_LOWER compilation
 total_amount_all 
------------------
           130330
(1 row)

SELECT COUNT(*) AS total_rows
FROM test_aggregates;
NOTICE:  [PGX-LOWER] Routing through PGX_LOWER compilation
 total_rows 
------------
          7
(1 row)

-- TODO: Do I need to support distinct in TPC-H?
-- SELECT COUNT(DISTINCT category) AS unique_categories
-- FROM test_aggregates;
SELECT AVG(amount) AS avg_amount_all
FROM test_aggregates;
NOTICE:  [PGX-LOWER] Routing through PGX_LOWER compilation
     avg_amount_all     
------------------------
 18618.5714285714285714
(1 row)

SELECT MIN(amount) AS min_amount_all
FROM test_aggregates;
NOTICE:  [PGX-LOWER] Routing through PGX_LOWER compilation
 min_amount_all 
----------------
          10050
(1 row)

SELECT MAX(amount) AS max_amount_all
FROM test_aggregates;
NOTICE:  [PGX-LOWER] Routing through PGX_LOWER compilation
 max_amount_all 
----------------
          30000
(1 row)

SELECT SUM(quantity) AS total_quantity
FROM test_aggregates;
NOTICE:  [PGX-LOWER] Routing through PGX_LOWER compilation
 total_quantity 
----------------
             28
(1 row)

SELECT AVG(price) AS avg_price
FROM test_aggregates;
NOTICE:  [PGX-LOWER] Routing through PGX_LOWER compilation
       avg_price       
-----------------------
 8196.5714285714285714
(1 row)

DROP TABLE test_aggregates;
