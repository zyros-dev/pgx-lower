LOAD 'pgx_lower.so';
DROP TABLE IF EXISTS table_a;
NOTICE:  table "table_a" does not exist, skipping
DROP TABLE IF EXISTS table_b;
NOTICE:  table "table_b" does not exist, skipping
DROP TABLE IF EXISTS table_c;
NOTICE:  table "table_c" does not exist, skipping
CREATE TABLE table_a
(
    id    INTEGER,
    value INTEGER,
    name  TEXT
);
CREATE TABLE table_b
(
    id     INTEGER,
    amount INTEGER,
    status TEXT
);
CREATE TABLE table_c
(
    id       INTEGER,
    category INTEGER,
    flag     INTEGER
);
INSERT INTO table_a(id, value, name)
VALUES (1, 100, 'apple'),
       (2, 200, 'banana'),
       (3, 300, 'cherry'),
       (4, 400, 'date');
INSERT INTO table_b(id, amount, status)
VALUES (1, 10, 'active'),
       (2, 20, 'pending'),
       (3, 30, 'active'),
       (5, 50, 'inactive');
INSERT INTO table_c(id, category, flag)
VALUES (1, 1, 1),
       (2, 1, 0),
       (3, 2, 1),
       (4, 2, 0);
SELECT *
FROM table_a, table_b
WHERE table_a.id = table_b.id;
NOTICE:  [PGX-LOWER] Routing through PGX_LOWER compilation
 id | value |  name  | id | amount | status  
----+-------+--------+----+--------+---------
  1 |   100 | apple  |  1 |     10 | active
  2 |   200 | banana |  2 |     20 | pending
  3 |   300 | cherry |  3 |     30 | active
(3 rows)

SELECT table_a.name, table_b.amount
FROM table_a, table_b
WHERE table_a.id = table_b.id;
NOTICE:  [PGX-LOWER] Routing through PGX_LOWER compilation
  name  | amount 
--------+--------
 apple  |     10
 banana |     20
 cherry |     30
(3 rows)

SELECT table_a.name, table_b.amount, table_b.status
FROM table_a, table_b
WHERE table_a.id = table_b.id AND table_b.status = 'active';
NOTICE:  [PGX-LOWER] Routing through PGX_LOWER compilation
  name  | amount | status 
--------+--------+--------
 apple  |     10 | active
 cherry |     30 | active
(2 rows)

SELECT table_a.name, table_b.amount, table_c.category
FROM table_a, table_b, table_c
WHERE table_a.id = table_b.id AND table_a.id = table_c.id;
NOTICE:  [PGX-LOWER] Routing through PGX_LOWER compilation
  name  | amount | category 
--------+--------+----------
 apple  |     10 |        1
 banana |     20 |        1
 cherry |     30 |        2
(3 rows)

SELECT table_a.name, table_a.value, table_b.amount
FROM table_a, table_b
WHERE table_a.id = table_b.id AND table_a.value > table_b.amount * 5;
NOTICE:  [PGX-LOWER] Routing through PGX_LOWER compilation
  name  | value | amount 
--------+-------+--------
 apple  |   100 |     10
 banana |   200 |     20
 cherry |   300 |     30
(3 rows)

SELECT table_a.name, table_b.amount
FROM table_a, table_b
WHERE table_a.id = table_b.id
ORDER BY table_b.amount DESC;
NOTICE:  [PGX-LOWER] Routing through PGX_LOWER compilation
  name  | amount 
--------+--------
 cherry |     30
 banana |     20
 apple  |     10
(3 rows)

SELECT table_a.id AS a_id, table_b.id AS b_id
FROM table_a, table_b
ORDER BY a_id, b_id;
NOTICE:  [PGX-LOWER] Routing through PGX_LOWER compilation
 a_id | b_id 
------+------
    1 |    1
    1 |    2
    1 |    3
    1 |    5
    2 |    1
    2 |    2
    2 |    3
    2 |    5
    3 |    1
    3 |    2
    3 |    3
    3 |    5
    4 |    1
    4 |    2
    4 |    3
    4 |    5
(16 rows)

SELECT table_a.name, table_a.value + table_b.amount AS total
FROM table_a, table_b
WHERE table_a.id = table_b.id;
NOTICE:  [PGX-LOWER] Routing through PGX_LOWER compilation
  name  | total 
--------+-------
 apple  |   110
 banana |   220
 cherry |   330
(3 rows)

SELECT table_c.category, SUM(table_a.value) AS total_value
FROM table_a, table_c
WHERE table_a.id = table_c.id
GROUP BY table_c.category
ORDER BY table_c.category;
NOTICE:  [PGX-LOWER] Routing through PGX_LOWER compilation
 category | total_value 
----------+-------------
        1 |         300
        2 |         700
(2 rows)

SELECT a1.name AS name1, a2.name AS name2
FROM table_a a1, table_a a2
WHERE a1.value < a2.value AND a1.id < a2.id
ORDER BY a1.name, a2.name;
NOTICE:  [PGX-LOWER] Routing through PGX_LOWER compilation
 name1  | name2  
--------+--------
 apple  | banana
 apple  | cherry
 apple  | date
 banana | cherry
 banana | date
 cherry | date
(6 rows)

DROP TABLE table_c;
DROP TABLE table_b;
DROP TABLE table_a;
