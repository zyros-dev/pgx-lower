LOAD 'pgx_lower.so';
SET client_min_messages TO NOTICE;
DROP TABLE IF EXISTS test;
-- Test our core minimal type foundation: INTEGER, BIGINT, BOOLEAN, SERIAL
CREATE TABLE test
(
    id              SERIAL PRIMARY KEY,
    integer_value   INTEGER,           -- Core integer type
    big_value       BIGINT,            -- 64-bit integer type  
    boolean_flag    BOOLEAN,           -- Boolean type
    category_code   INTEGER,           -- Replaces VARCHAR/TEXT (1=Electronics, 2=Books, etc.)
    amount_cents    INTEGER            -- Replaces DECIMAL (store as cents: $123.45 = 12345)
);
-- Insert test data using only our minimal supported types
INSERT INTO test (integer_value, big_value, boolean_flag, category_code, amount_cents)
SELECT 
    (1000 + i),                            -- integer_value: standard integers  
    (1000000000000 + i)::BIGINT,           -- big_value: big integers
    i % 2 = 0,                             -- boolean_flag: alternating true/false
    (i % 3) + 1,                           -- category_code: 1, 2, 3 (rotating categories)
    (10000 + i * 100)                      -- amount_cents: monetary values as cents
FROM generate_series(1, 5) AS s(i);
-- Test basic integer selections
SELECT id, integer_value, big_value FROM test;
NOTICE:  [PGX-LOWER] Routing through PGX_LOWER compilation
 id | integer_value |   big_value   
----+---------------+---------------
  1 |          1001 | 1000000000001
  2 |          1002 | 1000000000002
  3 |          1003 | 1000000000003
  4 |          1004 | 1000000000004
  5 |          1005 | 1000000000005
(5 rows)

-- Test boolean and category selections  
SELECT id, boolean_flag, category_code FROM test;
NOTICE:  [PGX-LOWER] Routing through PGX_LOWER compilation
 id | boolean_flag | category_code 
----+--------------+---------------
  1 | f            |             2
  2 | t            |             3
  3 | f            |             1
  4 | t            |             2
  5 | f            |             3
(5 rows)

-- Test amount selections
SELECT id, amount_cents FROM test;
NOTICE:  [PGX-LOWER] Routing through PGX_LOWER compilation
 id | amount_cents 
----+--------------
  1 |        10100
  2 |        10200
  3 |        10300
  4 |        10400
  5 |        10500
(5 rows)

-- Final comprehensive selection - test all minimal types together
SELECT id, integer_value, big_value, boolean_flag, category_code, amount_cents
FROM test;
NOTICE:  [PGX-LOWER] Routing through PGX_LOWER compilation
 id | integer_value |   big_value   | boolean_flag | category_code | amount_cents 
----+---------------+---------------+--------------+---------------+--------------
  1 |          1001 | 1000000000001 | f            |             2 |        10100
  2 |          1002 | 1000000000002 | t            |             3 |        10200
  3 |          1003 | 1000000000003 | f            |             1 |        10300
  4 |          1004 | 1000000000004 | t            |             2 |        10400
  5 |          1005 | 1000000000005 | f            |             3 |        10500
(5 rows)

DROP TABLE test;
