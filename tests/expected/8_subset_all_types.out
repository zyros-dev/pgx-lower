LOAD 'pgx_lower.so';
SET client_min_messages TO NOTICE;
DROP TABLE IF EXISTS all_types_test;
NOTICE:  table "all_types_test" does not exist, skipping
-- Test subset operations with only our minimal type foundation
CREATE TABLE all_types_test
(
    id              SERIAL PRIMARY KEY,
    integer_col     INTEGER,           -- Core integer type
    big_int         BIGINT,            -- 64-bit integer type  
    boolean_col     BOOLEAN,           -- Boolean type
    decimal_col     INTEGER,           -- Replaces DECIMAL - stored as cents
    varchar_col     INTEGER            -- Replaces VARCHAR - numeric codes
);
-- Insert deterministic test data using only minimal types
INSERT INTO all_types_test (integer_col, big_int, boolean_col, decimal_col, varchar_col)
SELECT 
    (1000 + i),                        -- integer_col: offset sequence
    (1000000000000 + i)::BIGINT,       -- big_int: large integers
    i % 2 = 0,                         -- boolean_col: alternating pattern
    (10000 + i * 100),                 -- decimal_col: stored as cents
    (i * 100)                          -- varchar_col: numeric identifiers
FROM generate_series(1, 3) AS s(i);
-- Test basic integer selections
SELECT id, integer_col, big_int FROM all_types_test;
NOTICE:  [PGX-LOWER] Routing through PGX_LOWER compilation
 id | integer_col |    big_int    
----+-------------+---------------
  1 |        1001 | 1000000000001
  2 |        1002 | 1000000000002
  3 |        1003 | 1000000000003
(3 rows)

-- Test boolean and monetary values
SELECT id, boolean_col, decimal_col, varchar_col FROM all_types_test;
NOTICE:  [PGX-LOWER] Routing through PGX_LOWER compilation
 id | boolean_col | decimal_col | varchar_col 
----+-------------+-------------+-------------
  1 | f           |       10100 |         100
  2 | t           |       10200 |         200
  3 | f           |       10300 |         300
(3 rows)

-- Test comprehensive selection - demonstrate all minimal types working together
SELECT id, integer_col, big_int, boolean_col, decimal_col, varchar_col
FROM all_types_test;
NOTICE:  [PGX-LOWER] Routing through PGX_LOWER compilation
 id | integer_col |    big_int    | boolean_col | decimal_col | varchar_col 
----+-------------+---------------+-------------+-------------+-------------
  1 |        1001 | 1000000000001 | f           |       10100 |         100
  2 |        1002 | 1000000000002 | t           |       10200 |         200
  3 |        1003 | 1000000000003 | f           |       10300 |         300
(3 rows)

DROP TABLE all_types_test;
